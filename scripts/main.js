!function(){"use strict";angular.module("tiy-gradebook",["ui.router","restangular","firebase"]).run(["$rootScope","$state",function(t,e){t.$on("$stateChangeError",function(t,n,o,r,s,i){return"AUTH_REQUIRED"===i?(t.preventDefault(),e.go("login")):void 0})}]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("login",{templateUrl:"views/login.html",controller:"Login",controllerAs:"app"}).state("classes",{"abstract":!0,controller:"Classes",controllerAs:"app",resolve:{User:["Auth",function(t){return t.required().then(function(){return t.me()})}]}}).state("classes.list",{url:"/",templateUrl:"views/classes.html",controller:"ClassList as org"}).state("classes.detail",{url:"/:repo",templateUrl:"views/class.html",controller:"ClassDetail as class"}),e.otherwise("/")}]).constant("API",{github:{base:"https://api.github.com/",org:"TheIronYard--Orlando"},firebase:{base:"https://tiy-gradebook.firebaseio.com"}}).factory("Firebase",["API",function(t){return new Firebase(t.firebase.base)}]).factory("Auth",["$q","$firebaseAuth","Github",function(t,e,n){function o(t){n.setDefaultHeaders(t&&{Authorization:"token "+t}||{})}function r(t){return t&&t.github&&t.github.accessToken}function s(t){o(r(t))}return e.$onAuth(function(t){s(t)}),{isAuthd:function(){return!!e.$getAuth()},login:function(){var t=this;return e.$authWithOAuthPopup("github").then(function(){return t.me()})},logout:function(){return t.when(e.$unauth())},required:function(){return e.$requireAuth().then(s)},me:function(){return this.isAuthd()&&n.one("user").get()}}}]).factory("Github",["Restangular","API",function(t,e){return t.withConfig(function(t){t.setBaseUrl(e.github.base).setRequestSuffix(e.github.suffix).extendCollection("classes",function(t){return t.fromServer?_(t).filter(function(t){return t.name.match(/(FEE|ROR|iOS)/)}).sortByOrder("updated_at",!1).value():t}).extendCollection("issues",function(t){return angular.extend(t,_.groupBy(t,function(t){return _.pluck(t.labels,"name").toString()||"none"}),{total:t.length})}).extendCollection("labels",function(t){return _.filter(t,function(t){return"Attendance"!==t.name})})})}]).controller("Login",["Auth","$state",function(t,e){this.login=function(){t.login().then(function(){e.go("classes.list")})}}]).controller("Classes",["Auth","$state",function(t,e){this.logout=function(){t.logout().then(function(){e.go("login")})}}]).controller("ClassList",["Github","API",function(t,e){this.repos=t.allUrl("classes",e.github.base+"orgs/"+e.github.org+"/repos").getList().$object}]).controller("ClassDetail",["Github","API","$stateParams",function(t,e,n){var o=t.one("repos",e.github.org).one(n.repo);this.repo=o.get().$object,t.extendModel("milestones",function(t){return t.issues=o.getList("issues",{state:"all",milestone:t.number}).$object,t}),this.milestones=o.getList("milestones",{state:"all"}).$object,this.labels=o.getList("labels").$object,this.percentOfType=function(t,e){return t&&t[e]?t[e].length/t.length*100:0}}]).controller("AssignmentList",function(){}).controller("AssignmentDetail",function(){}).controller("StudentList",function(){}).decorator("$firebaseAuth",["$delegate","Firebase",function(t,e){return t(e)}])}();